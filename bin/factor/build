#!/bin/bash

# _build <resource>
mkdir -p "${f_moddir}"

cat <<EOF >"${f_script_file}"
$(wzk-sekt -e -q -p 'export ' -t 'env' "${f_entry_conf}" default_factor_env)
$(wzk-sekt -e -q -p 'export ' -t 'env' "${CONFIG}" $f_env)
# BEGIN SCRIPT
EOF
wzk-sekt -n -t 'exec' "${CONFIG}" $f_exec >> "${f_script_file}"
chmod +x "${f_script_file}"
curr_hash="$(md5sum "${f_script_file}" | head -c32)"

_depcheck "${1}"
if [ $? -ne 13 ]; then
  _sync "${1}"
fi

(
env -C "${f_module}" -i "${f_script_file}" 2>&1 | @v "$(@s "${1}" 4 "Building")"
exit ${PIPESTATUS[0]}
)
@einz "Failed to build package ${1}"

_wrapup "${1}"

return 11
