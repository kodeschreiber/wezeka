#!/bin/bash

# _get_resource <resource>
wzk-sekt -e -q -p 'f_' -t 'entry' "${CONFIG}" "default_factor_values"

source <(wzk-sekt -e -q -p 'f_' -t 'entry' "${CONFIG}" "default_factor_values")
source <(wzk-sekt -e -q -p 'f_' -t 'entry' "${CONFIG}" "factor")
source <(wzk-sekt -e -q -p 'f_' -t 'entry' "${CONFIG}" "${1}")

# test ! -z "${f_url}"
# @einz "No url defined for ${1}"
test ! -z "${f_prefix}"
@einz "No prefix provided for ${1}"
test ! -z "${f_script}"
@einz "No script sections specified for ${1}"

f_moddir="${FACTDIR}/${1}"
f_meta="${f_moddir}/meta"
f_cache="${f_moddir}/cache"
f_module="${f_moddir}/module"
f_frozen="${f_moddir}/${1}_module.tar.gz"
f_rmodule="${RFACTDIR}/${1}/module"
f_script_file="${TMPDIR}/${1}.sh"
f_entry_conf="${TMPDIR}/${1}.conf"

cat <<EOF >"${f_entry_conf}"
[env default_factor_values]
PREFIX_CACHE="${f_cache}"
PREFIX_BUILD="${f_prefix}"
GIT_ROOT="${GIT_ROOT}"

[entry ${1}_defaults]
env=${f_env} ${1}
exec=${1}
EOF
